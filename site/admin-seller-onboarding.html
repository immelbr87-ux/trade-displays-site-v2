<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Seller Onboarding</title>
</head>
<body>

<h2>Seller Stripe Onboarding</h2>

<label>
  Seller Name:<br>
  <input type="text" id="sellerName" />
</label>
<br><br>

<label>
  Seller Email:<br>
  <input type="email" id="sellerEmail" />
</label>
<br><br>

<button id="startOnboarding">Start Stripe Onboarding</button>

<p id="statusMsg" style="margin-top:20px;"></p>

<script>
document.getElementById("startOnboarding").addEventListener("click", async () => {
  const sellerName = document.getElementById("sellerName").value;
  const sellerEmail = document.getElementById("sellerEmail").value;
  const statusMsg = document.getElementById("statusMsg");

  if (!sellerEmail) {
    statusMsg.textContent = "Seller email is required.";
    return;
  }

  statusMsg.textContent = "Creating Stripe account...";

  try {
    // STEP 1 — Create Stripe Connected Account
    const recordId = "recymg9sORo8pHXxl"; // ← paste the real Airtable record ID here

const accountRes = await fetch("/.netlify/functions/createConnectAccount", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    sellerName,
    sellerEmail,
    recordId
  })
});

      })
    });

    const accountData = await accountRes.json();

    if (!accountData.stripe_account_id) {
      throw new Error("Failed to create Stripe account.");
    }

    statusMsg.textContent = "Generating onboarding link...";

    // STEP 2 — Create Onboarding Link
    const linkRes = await fetch("/.netlify/functions/createOnboardingLink", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        stripe_account_id: accountData.stripe_account_id
      })
    });

    const linkData = await linkRes.json();

    if (!linkData.url) {
      throw new Error("Failed to create onboarding link.");
    }

    // STEP 3 — Redirect Seller to Stripe
    window.location.href = linkData.url;

  } catch (err) {
    console.error(err);
    statusMsg.textContent = "Something went wrong. Check console.";
  }
});
</script>

</body>
</html>
