<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product Details - SHOWROOM MARKET | Premium K&B Products</title>
  <meta name="description" content="View detailed information about this trade show display including specifications, pricing, and availability.">
  <link rel="stylesheet" href="app.css">
  <link rel="stylesheet" href="fixes.css">
</head>
<body>
  
  <!-- Header inserted via include.js -->
  
  <section class="container">
    <div id="productDetail" class="loading">
      <div class="spinner"></div>
      <p>Loading display details...</p>
    </div>
    
    <!-- Error State -->
    <div id="errorState" class="hidden" style="text-align: center; padding: 4rem 2rem;">
      <div style="font-size: 4rem; margin-bottom: 1rem;">⚠️</div>
      <h2>Display Not Found</h2>
      <p style="color: var(--text-muted); margin-top: 0.5rem;">This display may have been sold or removed.</p>
      <a href="market.html" class="btn btn-primary" style="margin-top: 1.5rem;">Browse All Displays</a>
    </div>
  </section>

  <!-- Footer inserted via include.js -->
  
  <script src="shared/include.js"></script>
  <script>
    let currentDisplay = null;
    let selectedDuration = 1; // weeks
    let currentImageIndex = 0;

    // Get display ID from URL
    const urlParams = new URLSearchParams(window.location.search);
    const displayId = urlParams.get('id');

    // Fetch display details
    async function loadDisplayDetails() {
      if (!displayId) {
        showError();
        return;
      }

      try {
        const response = await fetch(`/.netlify/functions/listDisplays`);
        const data = await response.json();
        
        currentDisplay = data.displays.find(d => d.id === displayId);
        
        if (!currentDisplay) {
          showError();
          return;
        }
        
        renderDisplayDetails();
      } catch (error) {
        console.error('Error loading display:', error);
        showError();
      }
    }

    // Render display details
    function renderDisplayDetails() {
      const container = document.getElementById('productDetail');
      container.className = 'product-detail';
      
      // Mock additional images (in real app, these would come from API)
      const images = [
        currentDisplay.imageUrl || 'https://via.placeholder.com/800',
        'https://via.placeholder.com/800/00ba88',
        'https://via.placeholder.com/800/111111',
        'https://via.placeholder.com/800/6b7280'
      ];
      
      container.innerHTML = `
        <!-- Product Gallery -->
        <div class="product-gallery">
          <div class="main-image" id="mainImage">
            <img src="${images[0]}" alt="${currentDisplay.name}">
          </div>
          <div class="thumbnail-grid">
            ${images.map((img, index) => `
              <div class="thumbnail ${index === 0 ? 'active' : ''}" onclick="changeImage(${index})">
                <img src="${img}" alt="View ${index + 1}">
              </div>
            `).join('')}
          </div>
        </div>
        
        <!-- Product Info -->
        <div class="product-info">
          <div class="badge badge-${currentDisplay.listingType === 'rent' ? 'info' : 'success'}" style="margin-bottom: 1rem;">
            ${currentDisplay.listingType === 'rent' ? 'Available for Rent' : 'For Sale'}
          </div>
          
          <h1>${currentDisplay.name}</h1>
          <p class="product-sku">SKU: ${currentDisplay.id}</p>
          
          <!-- Price Box -->
          <div class="price-box">
            <div class="price-label">
              ${currentDisplay.listingType === 'rent' ? 'Weekly Rental Price' : 'Purchase Price'}
            </div>
            <div class="price-amount">$${currentDisplay.price.toLocaleString()}</div>
            ${currentDisplay.listingType === 'buy' ? `
              <div class="price-trend">↑ 5% above market average</div>
            ` : ''}
          </div>
          
          <!-- Reserve/Buy Section -->
          <div class="reserve-section">
            ${currentDisplay.listingType === 'rent' ? `
              <h3>Select Rental Duration</h3>
              <div class="rental-duration">
                <button class="duration-btn active" onclick="selectDuration(1)">
                  <div style="font-weight: 800; font-size: 1.25rem;">1 Week</div>
                  <div style="font-size: 0.875rem; color: var(--text-muted); margin-top: 0.25rem;">$${currentDisplay.price}</div>
                </button>
                <button class="duration-btn" onclick="selectDuration(2)">
                  <div style="font-weight: 800; font-size: 1.25rem;">2 Weeks</div>
                  <div style="font-size: 0.875rem; color: var(--text-muted); margin-top: 0.25rem;">$${(currentDisplay.price * 1.8).toLocaleString()}</div>
                </button>
                <button class="duration-btn" onclick="selectDuration(4)">
                  <div style="font-weight: 800; font-size: 1.25rem;">1 Month</div>
                  <div style="font-size: 0.875rem; color: var(--text-muted); margin-top: 0.25rem;">$${(currentDisplay.price * 3.5).toLocaleString()}</div>
                </button>
              </div>
            ` : ''}
            
            <button class="btn btn-primary w-full" onclick="handleReserve()" style="padding: 1.25rem; font-size: 1.125rem;">
              ${currentDisplay.listingType === 'rent' ? 'Reserve Display' : 'Make Offer'}
            </button>
            
            <p style="text-align: center; color: var(--text-muted); font-size: 0.875rem; margin-top: 1rem;">
              ${currentDisplay.listingType === 'rent' ? 'Free cancellation up to 48 hours before event' : 'Secure payment • Protected by Trade Displays'}
            </p>
          </div>
          
          <!-- Product Specifications -->
          <div class="product-specs">
            <h3>Specifications</h3>
            <div class="specs-grid">
              <div class="spec-item">
                <div class="spec-label">Display Size</div>
                <div class="spec-value">${currentDisplay.size}</div>
              </div>
              <div class="spec-item">
                <div class="spec-label">Condition</div>
                <div class="spec-value">${currentDisplay.condition}</div>
              </div>
              <div class="spec-item">
                <div class="spec-label">Type</div>
                <div class="spec-value">${currentDisplay.type || 'Modular'}</div>
              </div>
              <div class="spec-item">
                <div class="spec-label">Weight</div>
                <div class="spec-value">${currentDisplay.weight || '450 lbs'}</div>
              </div>
              <div class="spec-item">
                <div class="spec-label">Material</div>
                <div class="spec-value">${currentDisplay.material || 'Aluminum Frame'}</div>
              </div>
              <div class="spec-item">
                <div class="spec-label">Setup Time</div>
                <div class="spec-value">${currentDisplay.setupTime || '2-3 hours'}</div>
              </div>
            </div>
          </div>
          
          <!-- Tabs Section -->
          <div class="tabs">
            <div class="tab-nav">
              <button class="tab-btn active" onclick="switchTab(0)">Description</button>
              <button class="tab-btn" onclick="switchTab(1)">Shipping</button>
              <button class="tab-btn" onclick="switchTab(2)">Returns</button>
            </div>
            
            <div class="tab-content active" id="tab0">
              <h4>About This Display</h4>
              <p>${currentDisplay.description || 'This premium trade show display offers exceptional visibility and professional presentation. Features modular design for easy setup and transport, with high-quality graphics and durable construction. Perfect for conventions, trade shows, and corporate events.'}</p>
              
              <h4 style="margin-top: 2rem;">Features</h4>
              <ul style="color: var(--text-muted); line-height: 2; margin-top: 0.5rem;">
                <li>Professional-grade aluminum frame</li>
                <li>High-resolution fabric graphics</li>
                <li>Tool-free assembly</li>
                <li>Includes carrying case</li>
                <li>LED lighting compatible</li>
                <li>Expandable configuration</li>
              </ul>
            </div>
            
            <div class="tab-content" id="tab1">
              <h4>Shipping Information</h4>
              <p>We offer white-glove shipping services for all displays. Your display will be carefully packed and shipped directly to your event location or warehouse.</p>
              
              <div style="margin-top: 1.5rem;">
                <div style="display: flex; justify-content: space-between; padding: 1rem 0; border-bottom: 1px solid var(--border);">
                  <span style="font-weight: 600;">Estimated Delivery</span>
                  <span>3-5 business days</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 1rem 0; border-bottom: 1px solid var(--border);">
                  <span style="font-weight: 600;">Shipping Cost</span>
                  <span>Calculated at checkout</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 1rem 0;">
                  <span style="font-weight: 600;">Tracking</span>
                  <span>Provided via email</span>
                </div>
              </div>
            </div>
            
            <div class="tab-content" id="tab2">
              <h4>Return Policy</h4>
              ${currentDisplay.listingType === 'rent' ? `
                <p>Rental returns must be initiated within 24 hours of event conclusion. Display must be returned in the same condition as received.</p>
                <ul style="color: var(--text-muted); line-height: 2; margin-top: 1rem;">
                  <li>Free cancellation up to 48 hours before event</li>
                  <li>Damage fees apply for excessive wear</li>
                  <li>Return shipping included in rental price</li>
                  <li>Cleaning fees may apply</li>
                </ul>
              ` : `
                <p>All sales are final. However, if the display arrives damaged or not as described, you may return it within 7 days for a full refund.</p>
                <ul style="color: var(--text-muted); line-height: 2; margin-top: 1rem;">
                  <li>7-day return window for damaged items</li>
                  <li>Must be in original packaging</li>
                  <li>Refund processed within 5-7 business days</li>
                  <li>Return shipping costs may apply</li>
                </ul>
              `}
            </div>
          </div>
        </div>
      `;
      
      // Store images for gallery
      window.displayImages = images;
    }

    // Change main image
    function changeImage(index) {
      currentImageIndex = index;
      const mainImage = document.getElementById('mainImage');
      mainImage.innerHTML = `<img src="${window.displayImages[index]}" alt="${currentDisplay.name}">`;
      
      // Update thumbnail active state
      document.querySelectorAll('.thumbnail').forEach((thumb, i) => {
        thumb.classList.toggle('active', i === index);
      });
    }

    // Select rental duration
    function selectDuration(weeks) {
      selectedDuration = weeks;
      document.querySelectorAll('.duration-btn').forEach(btn => btn.classList.remove('active'));
      event.target.closest('.duration-btn').classList.add('active');
    }

    // Switch tabs
    function switchTab(index) {
      document.querySelectorAll('.tab-btn').forEach((btn, i) => {
        btn.classList.toggle('active', i === index);
      });
      document.querySelectorAll('.tab-content').forEach((content, i) => {
        content.classList.toggle('active', i === index);
      });
    }

    // Handle reserve/buy
    function handleReserve() {
      if (!currentDisplay) return;
      
      // Prepare reservation data
      const reservationData = {
        displayId: currentDisplay.id,
        displayName: currentDisplay.name,
        listingType: currentDisplay.listingType,
        price: currentDisplay.price,
        duration: currentDisplay.listingType === 'rent' ? selectedDuration : null,
        totalPrice: currentDisplay.listingType === 'rent' ? 
          calculateRentalPrice(currentDisplay.price, selectedDuration) : 
          currentDisplay.price
      };
      
      // Store in sessionStorage
      sessionStorage.setItem('reservationData', JSON.stringify(reservationData));
      
      // Redirect to confirmation page
      window.location.href = 'reserve-confirmation.html';
    }

    // Calculate rental price based on duration
    function calculateRentalPrice(weeklyPrice, weeks) {
      const multipliers = {
        1: 1,
        2: 1.8,
        4: 3.5
      };
      return Math.round(weeklyPrice * (multipliers[weeks] || weeks));
    }

    // Show error state
    function showError() {
      document.getElementById('productDetail').classList.add('hidden');
      document.getElementById('errorState').classList.remove('hidden');
    }

    // Load display on page load
    loadDisplayDetails();
  </script>
</body>
</html>
