<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Reserve — Trade Displays by Bargain Bond</title>
  <meta name="description" content="Reserve an upcoming showroom display removal. Fixed pricing, local pickup, escrow until pickup confirmation." />
  <link rel="stylesheet" href="/app.css" />
</head>
<body>

  <div class="topbar">
    <div class="container topbar-inner">
      <a class="brand" href="/">
        <div class="logo">B</div>
        <div>TRADE DISPLAYS <small>by Bargain Bond</small></div>
      </a>

      <div class="navlinks" aria-label="Primary">
        <a href="/market" class="active">Browse displays</a>
        <a href="/for-showrooms">For showrooms</a>
        <a href="/brand-compliance">Brand compliance</a>
        <a href="/faq">FAQ</a>
        <a href="/pilot">Pilot</a>
      </div>

      <div class="navcta">
        <a class="btn btn-ghost" href="#signin">Sign In</a>
        <a class="btn btn-primary" href="#create">Create Account</a>
      </div>
    </div>
  </div>

  <div class="container pagewrap">
    <div class="page-hero">
      <div class="page-hero-inner">
        <div>
          <div class="kicker"><span class="dot"></span> Reserve • escrow held • pickup confirmation required</div>
          <h1 id="h1">Reserve listing</h1>
          <p class="lede" id="lede">Loading reservation summary…</p>
        </div>

        <div class="page-hero-actions">
          <a class="btn btn-pill" id="backToDetails" href="/market">Back</a>
          <a class="btn btn-pill btn-primary" id="continueBtn" href="#">Continue</a>
        </div>
      </div>
    </div>

    <div style="height:18px"></div>

    <div class="market-shell">
      <!-- LEFT -->
      <div class="panel">
        <h3>Reservation summary</h3>

        <div class="grid3" style="margin-top:12px;">
          <div class="kv">
            <div class="k">Listing</div>
            <div class="v" id="title">—</div>
          </div>
          <div class="kv">
            <div class="k">Price</div>
            <div class="v" id="price">—</div>
          </div>
          <div class="kv">
            <div class="k">Pickup window</div>
            <div class="v" id="window">—</div>
          </div>
        </div>

        <div style="height:14px"></div>

        <div class="callout">
          <strong>What “Reserve” means (pilot)</strong>
          <ul class="bullets" style="margin-top:10px;">
            <li>Price and pickup window are held for you.</li>
            <li>Funds are held until pickup confirmation.</li>
            <li>Condition is verified at pickup before release.</li>
          </ul>
        </div>

        <div style="height:14px"></div>

        <h3 style="margin-bottom:8px;">Buyer details (stub)</h3>
        <div class="formrow">
          <div>
            <div class="label">Your name</div>
            <input class="input" placeholder="Name" />
          </div>
          <div>
            <div class="label">Company</div>
            <input class="input" placeholder="Company" />
          </div>
          <div>
            <div class="label">Email</div>
            <input class="input" placeholder="Email" />
          </div>
        </div>

        <div style="height:12px"></div>

        <a class="btn btn-dark btn-full btn-pill" id="confirmReserve" href="#">Confirm reserve (fake)</a>

        <div class="small muted2" style="margin-top:10px;line-height:1.55;">
          This is a pilot UX screen for outreach credibility. No payment is processed in this demo.
        </div>
      </div>

      <!-- RIGHT -->
      <aside class="panel">
        <h3>Release conditions</h3>
        <ul class="bullets">
          <li>Buyer inspects at pickup.</li>
          <li>Showroom confirms grade on-site.</li>
          <li>Funds released only after confirmation.</li>
        </ul>

        <div style="height:12px"></div>

        <div class="callout">
          <strong>Final sale (trade-only)</strong>
          <div class="small muted">
            Items are sold as-installed. No manufacturer warranty is implied. Any included components are confirmed at pickup.
          </div>
        </div>
      </aside>
    </div>

    <div class="footer">
      <div class="hr"></div>
      <div class="fine">
        Trade Displays is operated by Bargain Bond. We facilitate escrow and commitment for scheduled showroom display removals.
      </div>
      <div class="footer-nav" aria-label="Footer navigation">
        <a href="/">Home</a>
        <a href="/market">Browse displays</a>
        <a href="/for-showrooms">For showrooms</a>
        <a href="/brand-compliance">Brand compliance</a>
        <a href="/faq">FAQ</a>
        <a href="/pilot">Pilot</a>
      </div>
    </div>
  </div>

  <script>
    (async function () {
      const params = new URLSearchParams(location.search);
      const id = params.get("id");

      const h1 = document.getElementById("h1");
      const lede = document.getElementById("lede");

      const back = document.getElementById("backToDetails");
      const cont = document.getElementById("continueBtn");
      const confirm = document.getElementById("confirmReserve");

      if (back) back.href = id ? `/listing-details?id=${encodeURIComponent(id)}` : "/market";

      const nextHref = id ? `/pickup-confirmation?id=${encodeURIComponent(id)}` : "/market";
      if (cont) cont.href = nextHref;
      if (confirm) confirm.href = nextHref;

      if (!id) {
        h1.textContent = "Missing listing id";
        lede.textContent = "Return to Browse displays and open a listing from there.";
        return;
      }

      try {
        const r = await fetch(`/.netlify/functions/listings?id=${encodeURIComponent(id)}`, { cache: "no-store" });
        const data = await r.json();
        if (!r.ok) throw new Error(data?.error || "Failed to load listing.");

        const x = data.listing || {};
        const title = x.title || "Display Listing";
        const price = (x.price != null && x.price !== "") ? `$${Number(x.price).toLocaleString()}` : "—";
        const windowLine = pickupWindowDateLine(x.pickup_window_start, x.pickup_window_end);

        h1.textContent = "Reserve (pilot)";
        lede.textContent = "You’re reserving a specific pickup window at a fixed price. Confirmation happens at pickup.";

        document.getElementById("title").textContent = title;
        document.getElementById("price").textContent = price;
        document.getElementById("window").textContent = windowLine;

      } catch (err) {
        console.error(err);
        h1.textContent = "Could not load reservation";
        lede.textContent = "Check the record id and your Public_Active view filters.";
      }

      function pickupWindowDateLine(start, end) {
        const s = parseDate(start), e = parseDate(end);
        if (!s || !e) return "Window: shown after reserve";
        return `${fmtShort(s)}–${fmtShort(e)}`;
      }
      function parseDate(v){ const d = new Date(v); return isNaN(d) ? null : d; }
      function fmtShort(d){ return d.toLocaleDateString(undefined, { month:"short", day:"numeric" }); }
    })();
  </script>

</body>
</html>
