<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pickup confirmation — Trade Displays</title>
  <meta name="description" content="Confirm acceptance at pickup. Escrow releases only after buyer confirmation on-site." />
  <link rel="stylesheet" href="app.css" />
</head>
<body>
  <div id="bb-header"></div>

  <div class="container section">
    <div class="pagehead">
      <div class="kicker">ON-SITE ACCEPTANCE</div>
      <h1 class="h2" style="margin:8px 0 0;">Pickup confirmation</h1>
      <p class="muted" style="max-width:880px; margin:8px 0 0;">This is the trust boundary: acceptance happens on-site. Once the buyer confirms the listing matches the disclosed condition and completeness, escrow releases and the transaction closes.</p>
    </div>

    <div class="panel" style="margin-top:16px;">
      <h3 style="margin-top:0;">Buyer checklist (2 minutes)</h3>
      <div class="two" style="margin-top:12px;">
        <div>
          <div class="small muted2" style="font-weight:800;">Verify match</div>
          <ul class="list" style="margin:10px 0 0;">
            <li>Model/specs match the listing</li>
            <li>Grade matches (A/B) per <a href="/trust">Condition Standards</a></li>
            <li>All disclosed parts are present (valves, trim, mounting hardware as listed)</li>
            <li>Photos reflect actual item</li>
          </ul>
        </div>
        <div>
          <div class="small muted2" style="font-weight:800;">Logistics</div>
          <ul class="list" style="margin:10px 0 0;">
            <li>Pickup-only, buyer arranges transport</li>
            <li>Item is sold as-is; no post-pickup claims</li>
            <li>If mismatch: do not load; document and report on-site</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="panel" style="margin-top:16px;">
      <h3 style="margin-top:0;">Confirm acceptance</h3>
      <p class="muted" style="margin-top:6px;">In production, this action releases escrow and records an acceptance receipt. This static preview will simulate and show the payload.</p>

      <form id="acceptForm" style="margin-top:14px;" class="form">
        <div class="two">
          <div>
            <label class="label">Listing ID</label>
            <input class="input" name="id" placeholder="e.g., recXXXXXXXX" required />
          </div>
          <div>
            <label class="label">Buyer name</label>
            <input class="input" name="buyer" placeholder="Full name" required />
          </div>
        </div>
        <div class="two">
          <div>
            <label class="label">Pickup date</label>
            <input class="input" name="date" type="date" required />
          </div>
          <div>
            <label class="label">Acceptance outcome</label>
            <select class="input" name="outcome" required>
              <option value="accepted">Accepted (release escrow)</option>
              <option value="mismatch">Mismatch (do not load)</option>
            </select>
          </div>
        </div>
        <div>
          <label class="label">Notes (optional)</label>
          <textarea class="input" name="notes" rows="4" placeholder="If mismatch, describe what did not match."></textarea>
        </div>

        <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;">
          <button class="btn btn-primary btn-pill" type="submit">Submit</button>
          <a class="btn btn-pill" href="/market">Back to market</a>
        </div>
      </form>

      <div id="result" style="margin-top:14px;"></div>
    </div>

    <div class="panel" style="margin-top:16px;">
      <h3 style="margin-top:0;">If there’s a mismatch</h3>
      <p class="muted" style="margin-top:6px;">Don’t load the item. Take photos, note the discrepancy, and notify support while on-site. This prevents disputes after the item leaves the showroom.</p>
      <a class="btn btn-pill" href="/contact">Contact support</a>
    </div>
  </div>

  <div id="bb-footer"></div>
  <script src="shared/include.js"></script>

  <script>
  (function(){
    const url = new URL(location.href);
    const form = document.getElementById('acceptForm');
    const res = document.getElementById('result');
    const idPreset = url.searchParams.get('id') || '';
    if(idPreset) form.elements.id.value = idPreset;

    const esc = (s)=>String(s).replace(/[&<>]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;'}[c]));

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      res.innerHTML = '<div class="muted">Submitting…</div>';

      const payload = {
        id: form.elements.id.value.trim(),
        buyer: form.elements.buyer.value.trim(),
        pickup_date: form.elements.date.value,
        outcome: form.elements.outcome.value,
        notes: form.elements.notes.value.trim(),
        ts: new Date().toISOString()
      };

      try{
        const r = await fetch('/.netlify/functions/confirmPickup', {
          method:'POST',
          headers:{'content-type':'application/json'},
          body: JSON.stringify(payload)
        });
        const data = await r.json();
        if(!r.ok) throw new Error(data?.error || 'Unable to submit.');

        res.innerHTML = `<div class="panel"><h3 style="margin-top:0;">Recorded</h3><p class="muted" style="margin:0;">Confirmation saved. If accepted, escrow would release and the listing would close.</p></div>`;
        form.reset();
      }catch(err){
        res.innerHTML = `<div class="panel"><h3 style="margin-top:0;">Saved (preview mode)</h3><p class="muted" style="margin:0;">This static preview can’t call the live endpoint. Payload:</p><pre style="white-space:pre-wrap; margin:12px 0 0; background:#0b0b0f; color:#fff; padding:12px; border-radius:12px; overflow:auto;">${esc(JSON.stringify(payload, null, 2))}</pre></div>`;
      }
    });
  })();
  </script>
</body>
</html>
