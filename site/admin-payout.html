<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Admin – Send Seller Payout</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; padding: 24px; max-width: 760px; margin: 0 auto; }
    input, button { font-size: 16px; padding: 10px 12px; }
    input { width: 100%; max-width: 520px; }
    button { cursor: pointer; }
    .row { margin: 16px 0; }
    .status { margin-top: 16px; padding: 12px; border: 1px solid #ddd; background: #fafafa; }
    .small { color: #666; font-size: 14px; }
    code { background: #f3f3f3; padding: 2px 6px; border-radius: 4px; }
  </style>
</head>
<body>

  <h2>Admin – Send Seller Payout</h2>
  <p class="small">
    This calls <code>/.netlify/functions/sendSellerPayout</code> with an Airtable <code>recordId</code>.
    Use only after pickup is confirmed.
  </p>

  <div class="row">
    <label for="recordId"><strong>Airtable Record ID</strong> (starts with <code>rec</code>):</label><br><br>
    <input id="recordId" type="text" placeholder="recXXXXXXXXXXXXXX" />
  </div>

  <div class="row">
    <button id="sendPayoutBtn">Send Payout</button>
  </div>

  <div id="status" class="status">Status: waiting…</div>

  <script>
    const statusEl = document.getElementById("status");

    document.getElementById("sendPayoutBtn").addEventListener("click", async () => {
      const recordId = document.getElementById("recordId").value.trim();

      if (!recordId || !recordId.startsWith("rec")) {
        statusEl.textContent = "Status: Please enter a valid Airtable recordId (starts with rec…)";
        return;
      }

      statusEl.textContent = "Status: Sending payout…";

      try {
        const res = await fetch("/.netlify/functions/sendSellerPayout", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ recordId })
        });

        const data = await res.json().catch(() => ({}));

        if (!res.ok) {
          statusEl.textContent = `Status: Error (${res.status}) — ${data.error || "Unknown error"}`;
          return;
        }

        statusEl.textContent = `Status: ✅ Success — transfer_id: ${data.transfer_id}`;
      } catch (err) {
        console.error(err);
        statusEl.textContent = "Status: ❌ Network or server error. Check console + Netlify function logs.";
      }
    });
  </script>

</body>
</html>
