<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Browse Displays - Trade Displays Marketplace</title>
  <meta name="description" content="Browse hundreds of trade show displays available for rent or purchase. Filter by size, type, and price.">
  <link rel="stylesheet" href="app.css">
</head>
<body>
  
  <!-- Header inserted via include.js -->
  
  <section class="container" style="padding: 3rem 0;">
    <h1 style="margin-bottom: 1rem;">Browse Displays</h1>
    <p style="color: var(--text-muted); margin-bottom: 2rem;">Find the perfect display for your next trade show or event.</p>
    
    <!-- Filters -->
    <div class="filters">
      <div class="search-box">
        <input type="text" id="searchInput" placeholder="Search displays...">
      </div>
      
      <div class="filter-group">
        <label style="font-weight: 600; margin-right: 0.5rem;">Type:</label>
        <button class="filter-btn active" data-filter="all">All</button>
        <button class="filter-btn" data-filter="rent">Rent</button>
        <button class="filter-btn" data-filter="buy">Buy</button>
      </div>
      
      <div class="filter-group">
        <label style="font-weight: 600; margin-right: 0.5rem;">Size:</label>
        <select class="form-select" id="sizeFilter" style="width: auto; padding: 0.625rem 1rem;">
          <option value="all">All Sizes</option>
          <option value="10x10">10x10</option>
          <option value="10x20">10x20</option>
          <option value="20x20">20x20</option>
          <option value="custom">Custom</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label style="font-weight: 600; margin-right: 0.5rem;">Sort:</label>
        <select class="form-select" id="sortSelect" style="width: auto; padding: 0.625rem 1rem;">
          <option value="newest">Newest First</option>
          <option value="price-low">Price: Low to High</option>
          <option value="price-high">Price: High to Low</option>
          <option value="popular">Most Popular</option>
        </select>
      </div>
    </div>
    
    <!-- Results Count -->
    <div style="margin-bottom: 2rem;">
      <p id="resultsCount" style="color: var(--text-muted); font-weight: 500;">Loading displays...</p>
    </div>
    
    <!-- Displays Grid -->
    <div class="grid grid-4" id="displaysGrid">
      <div class="loading">
        <div class="spinner"></div>
        <p>Loading displays...</p>
      </div>
    </div>
    
    <!-- Empty State -->
    <div id="emptyState" class="hidden" style="text-align: center; padding: 4rem 2rem;">
      <div style="font-size: 4rem; margin-bottom: 1rem;">üîç</div>
      <h3>No displays found</h3>
      <p style="color: var(--text-muted); margin-top: 0.5rem;">Try adjusting your filters or search criteria.</p>
      <button onclick="resetFilters()" class="btn btn-outline" style="margin-top: 1.5rem;">Reset Filters</button>
    </div>
  </section>

  <!-- Footer inserted via include.js -->
  
  <script src="shared/include.js"></script>
  <script>
    let allDisplays = [];
    let currentFilter = 'all';
    let currentSize = 'all';
    let currentSort = 'newest';
    let searchQuery = '';

    // Fetch displays from Netlify Function
    async function loadDisplays() {
      try {
        const response = await fetch('/.netlify/functions/listDisplays');
        const data = await response.json();
        allDisplays = data.displays;
        
        filterAndRenderDisplays();
      } catch (error) {
        console.error('Error loading displays:', error);
        document.getElementById('displaysGrid').innerHTML = `
          <div style="text-align: center; padding: 2rem; grid-column: 1 / -1;">
            <p style="color: var(--error);">Unable to load displays. Please try again later.</p>
          </div>
        `;
      }
    }

    // Filter and render displays
    function filterAndRenderDisplays() {
      let filtered = [...allDisplays];
      
      // Apply type filter
      if (currentFilter !== 'all') {
        filtered = filtered.filter(d => d.listingType === currentFilter);
      }
      
      // Apply size filter
      if (currentSize !== 'all') {
        filtered = filtered.filter(d => d.size.toLowerCase().includes(currentSize.toLowerCase()));
      }
      
      // Apply search
      if (searchQuery) {
        filtered = filtered.filter(d => 
          d.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
          d.description?.toLowerCase().includes(searchQuery.toLowerCase())
        );
      }
      
      // Sort
      switch(currentSort) {
        case 'price-low':
          filtered.sort((a, b) => a.price - b.price);
          break;
        case 'price-high':
          filtered.sort((a, b) => b.price - a.price);
          break;
        case 'popular':
          filtered.sort((a, b) => (b.views || 0) - (a.views || 0));
          break;
        case 'newest':
        default:
          filtered.sort((a, b) => new Date(b.createdAt || 0) - new Date(a.createdAt || 0));
      }
      
      renderDisplays(filtered);
      updateResultsCount(filtered.length);
    }

    // Render displays
    function renderDisplays(displays) {
      const grid = document.getElementById('displaysGrid');
      const emptyState = document.getElementById('emptyState');
      
      if (displays.length === 0) {
        grid.classList.add('hidden');
        emptyState.classList.remove('hidden');
        return;
      }
      
      grid.classList.remove('hidden');
      emptyState.classList.add('hidden');
      
      grid.innerHTML = displays.map(display => `
        <a href="listing-details.html?id=${display.id}" class="card" style="text-decoration: none; color: inherit;">
          <div class="card-image">
            <img src="${display.imageUrl || 'https://via.placeholder.com/400'}" alt="${display.name}">
          </div>
          <div class="badge badge-${display.listingType === 'rent' ? 'info' : 'success'}" style="margin-bottom: 0.5rem;">
            ${display.listingType === 'rent' ? 'For Rent' : 'For Sale'}
          </div>
          <h3 class="card-title">${display.name}</h3>
          <div class="card-price">$${display.price.toLocaleString()}${display.listingType === 'rent' ? '/week' : ''}</div>
          <div class="card-meta">${display.size} ‚Ä¢ ${display.condition}</div>
        </a>
      `).join('');
    }

    // Update results count
    function updateResultsCount(count) {
      document.getElementById('resultsCount').textContent = 
        `Showing ${count} ${count === 1 ? 'display' : 'displays'}`;
    }

    // Reset filters
    function resetFilters() {
      currentFilter = 'all';
      currentSize = 'all';
      currentSort = 'newest';
      searchQuery = '';
      
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.filter === 'all');
      });
      document.getElementById('sizeFilter').value = 'all';
      document.getElementById('sortSelect').value = 'newest';
      document.getElementById('searchInput').value = '';
      
      filterAndRenderDisplays();
    }

    // Event listeners
    document.addEventListener('DOMContentLoaded', () => {
      // Type filter buttons
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          currentFilter = btn.dataset.filter;
          filterAndRenderDisplays();
        });
      });
      
      // Size filter
      document.getElementById('sizeFilter').addEventListener('change', (e) => {
        currentSize = e.target.value;
        filterAndRenderDisplays();
      });
      
      // Sort select
      document.getElementById('sortSelect').addEventListener('change', (e) => {
        currentSort = e.target.value;
        filterAndRenderDisplays();
      });
      
      // Search input with debounce
      let searchTimeout;
      document.getElementById('searchInput').addEventListener('input', (e) => {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
          searchQuery = e.target.value;
          filterAndRenderDisplays();
        }, 300);
      });
      
      // Check URL parameters for filters
      const urlParams = new URLSearchParams(window.location.search);
      const filterParam = urlParams.get('filter');
      if (filterParam && ['all', 'rent', 'buy'].includes(filterParam)) {
        currentFilter = filterParam;
        document.querySelectorAll('.filter-btn').forEach(btn => {
          btn.classList.toggle('active', btn.dataset.filter === filterParam);
        });
      }
      
      // Load displays
      loadDisplays();
    });
  </script>
</body>
</html>
