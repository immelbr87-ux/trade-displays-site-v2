<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Admin â€“ Seller Onboarding + Payout</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; padding: 24px; max-width: 900px; margin: 0 auto; }
    h1 { font-size: 22px; margin-bottom: 8px; }
    h2 { font-size: 18px; margin-top: 28px; }
    .card { border: 1px solid #e5e5e5; border-radius: 12px; padding: 16px; margin-top: 12px; background: #fff; }
    label { display:block; font-weight: 600; margin: 12px 0 6px; }
    input { width: 100%; max-width: 520px; padding: 10px 12px; font-size: 16px; border: 1px solid #ddd; border-radius: 10px; }
    button { padding: 10px 14px; font-size: 16px; border: 1px solid #111; border-radius: 10px; background: #111; color: #fff; cursor: pointer; margin-right: 10px; }
    button.secondary { background:#fff; color:#111; }
    .status { margin-top: 14px; padding: 12px; border: 1px solid #eee; border-radius: 10px; background: #fafafa; white-space: pre-wrap; }
  </style>
</head>
<body>

<!-- ðŸ” PASSWORD GATE -->
<div id="gate" style="position:fixed;inset:0;background:#0b0b0b;display:flex;align-items:center;justify-content:center;z-index:99999;">
  <div style="width:min(520px,92vw);background:#111;border:1px solid #2a2a2a;border-radius:16px;padding:18px;color:#fff;">
    <div style="font-size:18px;font-weight:700;margin-bottom:8px;">Admin Access Required</div>
    <input id="gatePass" type="password" placeholder="Enter Admin Passcode"
      style="width:100%;padding:12px;border-radius:12px;border:1px solid #333;background:#0b0b0b;color:#fff;font-size:16px;" />
    <div style="margin-top:12px;display:flex;gap:10px;align-items:center;">
      <button id="gateBtn" style="padding:10px 14px;border-radius:12px;border:1px solid #fff;background:#fff;color:#111;font-weight:700;cursor:pointer;">Unlock</button>
      <div id="gateMsg" style="color:#ffb4b4;font-size:14px;"></div>
    </div>
  </div>
</div>

<div id="adminApp" style="display:none;">

  <h1>Admin â€“ Seller Onboarding + Payout</h1>

  <div class="card">
    <h2>1) Airtable Record</h2>
    <label>Airtable recordId</label>
    <input id="recordId" placeholder="recXXXXXXXXXXXXXX" />
    <div class="status" id="recordStatus">Status: waitingâ€¦</div>
  </div>

  <div class="card">
    <h2>2) Seller Stripe Onboarding</h2>
    <label>Seller name</label>
    <input id="sellerName" placeholder="Showroom LLC" />
    <label>Seller email</label>
    <input id="sellerEmail" placeholder="seller@email.com" />
    <button id="startOnboardingBtn">Start Stripe Onboarding</button>
    <div class="status" id="onboardingStatus">Status: waitingâ€¦</div>
  </div>

  <div class="card">
    <h2>3) Send Seller Payout</h2>
    <label>Stripe Account ID</label>
    <input id="stripeAccountId" placeholder="acct_xxxxxxxxxx" />
    <label>Amount (USD)</label>
    <input id="payoutAmount" placeholder="250.00" />
    <button id="sendPayoutBtn">Send Payout</button>
    <div class="status" id="payoutStatus">Status: waitingâ€¦</div>
  </div>

</div>

<script>
// ðŸ” CHANGE THESE TWO VALUES
const ADMIN_PASSCODE = "SR2026BargainBond!";
const ADMIN_PAYOUT_SECRET = "SM_PAYOUT_LOCK_2026!x9A$72";

// Gate logic
const gate = document.getElementById("gate");
const adminApp = document.getElementById("adminApp");
const gatePass = document.getElementById("gatePass");
const gateBtn = document.getElementById("gateBtn");
const gateMsg = document.getElementById("gateMsg");

function unlock() {
  gate.style.display = "none";
  adminApp.style.display = "block";
}

gateBtn.addEventListener("click", () => {
  if (gatePass.value.trim() === ADMIN_PASSCODE) unlock();
  else gateMsg.textContent = "Incorrect passcode.";
});

// Onboarding
document.getElementById("startOnboardingBtn").onclick = async () => {
  const sellerName = document.getElementById("sellerName").value;
  const sellerEmail = document.getElementById("sellerEmail").value;
  const recordId = document.getElementById("recordId").value;

  const res = await fetch("/.netlify/functions/createConnectAccount", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ sellerName, sellerEmail, recordId })
  });

  const data = await res.json();
  if (!res.ok) return alert(data.error || "Error creating account");

  const linkRes = await fetch("/.netlify/functions/createOnboardingLink", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ stripe_account_id: data.stripe_account_id })
  });

  const linkData = await linkRes.json();
  window.location.href = linkData.url;
};

// Payout
document.getElementById("sendPayoutBtn").onclick = async () => {
  const stripeAccountId = document.getElementById("stripeAccountId").value;
  const amount = parseFloat(document.getElementById("payoutAmount").value);

  const res = await fetch("/.netlify/functions/sendSellerPayout", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "x-admin-secret": ADMIN_PAYOUT_SECRET
    },
    body: JSON.stringify({ stripeAccountId, amount })
  });

  const data = await res.json();
  if (!res.ok) alert(data.error || "Error sending payout");
  else alert("Success â€” Transfer ID: " + data.payoutId);
};
</script>

</body>
</html>
