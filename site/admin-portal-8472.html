<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Showroom Market Admin Portal</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
</head>
<body style="font-family: Arial; padding: 24px; max-width: 1100px; margin:auto;">

<h1>Showroom Market Admin Portal</h1>

<label>Admin Password:</label>
<input type="password" id="adminToken" style="width:320px;padding:8px;">
<button onclick="saveToken()">Unlock</button>
<span id="tokenStatus"></span>

<hr>

<div style="margin:20px 0;">
  <button onclick="showTab('pickup')">Pickup Scan</button>
  <button onclick="showTab('ops')">Pickup Ops</button>
</div>

<div id="pickupTab">
  <h2>Scan Pickup QR</h2>
  <input id="payload" placeholder="SMK|recXXXX|token" style="width:420px;padding:10px;">
  <button onclick="verify()">Verify & Pay</button>
  <pre id="out" style="background:#111;color:#0f0;padding:12px;"></pre>
</div>

<div id="opsTab" style="display:none;">
  <h2>Pickup Operations</h2>
  <button onclick="loadOps()">Refresh</button>
  <pre id="opsOut"></pre>
</div>

<script>
function saveToken() {
  localStorage.setItem("ADMIN_TOKEN", document.getElementById("adminToken").value);
  document.getElementById("tokenStatus").innerText = "Saved âœ”";
}

function authedFetch(url, options={}) {
  options.headers = {
    ...(options.headers||{}),
    "Content-Type":"application/json",
    "Authorization":`Bearer ${localStorage.getItem("ADMIN_TOKEN")}`
  };
  return fetch(url, options);
}

function showTab(tab) {
  document.getElementById("pickupTab").style.display = tab==="pickup"?"block":"none";
  document.getElementById("opsTab").style.display = tab==="ops"?"block":"none";
}

async function verify() {
  const payload = document.getElementById("payload").value;
  const res = await authedFetch("/.netlify/functions/admin", {
    method:"POST",
    body:JSON.stringify({ action:"verify_pickup_and_payout", payload })
  });
  document.getElementById("out").textContent = JSON.stringify(await res.json(),null,2);
}

async function loadOps() {
  const res = await authedFetch("/.netlify/functions/admin", {
    method:"POST",
    body:JSON.stringify({ action:"get_ops" })
  });
  document.getElementById("opsOut").textContent = JSON.stringify(await res.json(),null,2);
}
</script>

</body>
</html>
